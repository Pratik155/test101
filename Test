import matplotlib.pyplot as plt
from matplotlib.patches import Rectangle
from pptx import Presentation
from io import BytesIO
import pandas as pd

# Sample dataframe
data = {
    'Conversation_id': [1, 2, 3, 4, 5],
    'customer_id': [101, 102, 103, 104, 105],
    'call_summary': ['Summary 1', 'Summary 2', 'Summary 3', 'Summary 4', 'Summary 5'],
    'NPS': [9, 7, 8, 5, 6],
    'pain_point': ['Pain Point 1', 'Pain Point 2', 'Pain Point 3', 'Pain Point 4', 'Pain Point 5'],
    'customer_feedback': ['Feedback 1', 'Feedback 2', 'Feedback 3', 'Feedback 4', 'Feedback 5']
}

df = pd.DataFrame(data)

# Function to create image with boxes and text
def create_image(row):
    fig, ax = plt.subplots(figsize=(8, 4))
    ax.add_patch(Rectangle((0, 0), 8, 4, edgecolor='black', facecolor='lightblue'))
    plt.text(0.5, 0.9, f"Conversation_id: {row['Conversation_id']}", fontsize=12, ha='left', va='center')
    plt.text(0.5, 0.75, f"Customer_id: {row['customer_id']}", fontsize=12, ha='left', va='center')
    plt.text(0.5, 0.6, f"Call Summary: {row['call_summary']}", fontsize=12, ha='left', va='center')
    plt.text(0.5, 0.45, f"NPS: {row['NPS']}", fontsize=12, ha='left', va='center')
    plt.text(0.5, 0.3, f"Pain Point: {row['pain_point']}", fontsize=12, ha='left', va='center')
    plt.text(0.5, 0.15, f"Customer Feedback: {row['customer_feedback']}", fontsize=12, ha='left', va='center')
    ax.axis('off')
    plt.tight_layout()
    # Save the plot to a BytesIO object
    buffer = BytesIO()
    plt.savefig(buffer, format='png')
    buffer.seek(0)
    plt.close(fig)
    return buffer

# Create PowerPoint presentation
prs = Presentation()

# Iterate over each row and add slide with image
for index, row in df.iterrows():
    # Create slide
    slide = prs.slides.add_slide(prs.slide_layouts[5])
    # Add image to slide
    image_stream = create_image(row)
    left = top = prs.slide_width // 8
    slide.shapes.add_picture(image_stream, left, top, width=prs.slide_width*3/4)

# Save presentation
prs.save('output.pptx')
