import pandas as pd
import multiprocessing

def process_row(row, featurename):
    insight = getInsight(row['conversation'], featurename)
    return row, insight

def get_insights_parallel(df, featurenamelist, max_processes=20):
    results = []
    with multiprocessing.Pool(processes=min(len(df), max_processes)) as pool:
        for featurename in featurenamelist:
            results.extend(pool.starmap(process_row, [(row, featurename) for _, row in df.iterrows()]))
    return results

# Assuming df is your DataFrame and featurenamelist is your list of feature names
insights = get_insights_parallel(df, featurenamelist)

# Extracting insights and adding them as a new column to the DataFrame
for i, featurename in enumerate(featurenamelist):
    df[f'Insight_{i+1}'] = [insight[i][1] for insight in insights]

# Displaying the modified DataFrame with insights as new columns
print(df)
